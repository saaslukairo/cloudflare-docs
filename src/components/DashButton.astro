---
import { z } from "astro:schema";
import { LinkButton } from "@astrojs/starlight/components";
import CoreRoutes from "~/content/dash-routes/core.json";
import CoreManuallyDefinedRoutes from "~/content/dash-routes/core-manually-defined.json";
import ZeroTrustRoutes from "~/content/dash-routes/zero-trust.json";

const props = z
	.object({
		url: z.string(),
		zeroTrust: z.boolean().optional().default(false),
		buttonName: z.string().optional(),
	})
	.strict();

const { url, zeroTrust, buttonName } = props.parse(Astro.props);

const allCoreRoutes = CoreRoutes.concat(CoreManuallyDefinedRoutes);

const routes = zeroTrust ? ZeroTrustRoutes : allCoreRoutes;

const route = routes.find((route) => route.deeplink === url);

if (!route) {
	throw new Error(`[DashButton] No route found for ${url}`);
}

/*
If working locally and wanting to catch multiple missing routes, update above to the following

let route = routes.find((route) => route.deeplink === url);

if (!route) {
	console.warn(`[DashButton] No route found for ${url}`);
	route = {
		name: "Account home",
		deeplink: "/?to=/:account/home",
	};
}
*/

const name = buttonName ?? route.name;
const baseUrl = zeroTrust
	? "https://one.dash.cloudflare.com"
	: "https://dash.cloudflare.com";

let { href } = new URL(route.deeplink, baseUrl);
---

<LinkButton href={href} icon="external" target="_blank"
	>Go to <strong>{name}</strong></LinkButton
>

<style>
	.sl-link-button {
		padding: 0.1875rem 0.5rem;

		svg {
			--sl-icon-size: 1rem !important;
		}
	}
</style>
