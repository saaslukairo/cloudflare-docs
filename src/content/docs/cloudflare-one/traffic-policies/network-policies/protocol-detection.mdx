---
title: Protocol detection
pcx_content_type: how-to
sidebar:
  order: 2
---

import { Badge, Render } from "~/components";

Gateway supports the detection, logging, and filtering of network protocols using packet attributes.

Protocol detection only applies to devices connected to Cloudflare One via the WARP client in [Gateway with WARP](/cloudflare-one/team-and-resources/devices/warp/configure-warp/warp-modes/#gateway-with-warp-default) mode.

## Turn on protocol detection

To turn on protocol detection:

1. In [Cloudflare One](https://one.dash.cloudflare.com/), go to **Traffic policies** > **Traffic settings** > **Proxy and inspection settings**.
2. Turn on **Allow protocol detection**.

You can now use _Detected Protocol_ as a selector in a [Network policy](/cloudflare-one/traffic-policies/network-policies/#detected-protocol).

### Inspect on all ports <Badge text="Beta" variant="caution" size="small" />

<Render
	file="gateway/inspect-on-all-ports"
	product="cloudflare-one"
	params={{
		turnOnProcedure:
			"under **HTTP inspection ports**, choose _Inspect on all ports_",
	}}
/>

## Supported protocols

Gateway supports detection and filtering of the following protocols:

| Protocol | Notes                                                                                       |
| -------- | ------------------------------------------------------------------------------------------- |
| HTTP     | The policy builder includes separate values for HTTP/1.1 and HTTP/2.                        |
| SSH      |                                                                                             |
| TLS      | Gateway detects TLS versions 1.1 through 1.3 with the _TLS_ value.                          |
| DCE/RPC  |                                                                                             |
| MQTT     |                                                                                             |
| TPKT     | TPKT commonly initiates RDP sessions, so you can use it to identify and filter RDP traffic. |
| DNP3     |                                                                                             |

## Example network policy

You can create network policies that filter traffic based on protocol detections rather than common ports. For example, you can block all SSH traffic on your network without blocking port 22 or any other non-default ports:

| Selector          | Operator | Value | Action |
| ----------------- | -------- | ----- | ------ |
| Detected Protocol | in       | _SSH_ | Block  |
